---
- version: 2.2
  shortdesc: Apache Webserver
  longdesc: >
    Configure a resource group containing a virtual IP address and
    an instance of the Apache web server.
  category: Server
  include:
    - agent: test:apache
      name: apache
    - agent: test:virtual-ip
      name: virtual-ip
  parameters:
    - name: id
      shortdesc: The ID specified here is for the web server resource group.
    - name: install
      type: boolean
      default: true
      shortdesc: Disable if no installation should be performed
  actions:
    - install:
        - apache2
      when: install
    - call: a2enable mod_status
      shortdesc: Enable status module
      nodes: all
      when: install
    - include: apache
    - include: virtual-ip
    - cib: |
        group {{id}}
          {{virtual-ip:id}}
          {{apache:id}}
