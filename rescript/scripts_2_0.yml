---
- version: 2.2
  shortdesc: Apache Webserver
  longdesc: >
    Configure a resource group containing a virtual IP address and
    an instance of the Apache web server. You can optionally configure
    a Filesystem resource which will be mounted before the web server
    is started. You can also optionally configure a database resource
    which will be started before the web server but after mounting the
    optional filesystem.
  category: Basic
  include:
    - agent: ocf:heartbeat:apache
      name: apache
    - agent: ocf:heartbeat:IPaddr2
      name: virtual-ip
      description: The IP address configured here will start before the Apache instance.
    - agent: ocf:heartbeat:Filesystem
      name: filesystem
      optional: true
    - agents: database
      name: database
      optional: true
  parameters:
    - name: id
      description: The ID specified here is for the web server resource group.
    - name: install
      type: option
      default: true
      description: Disable if no installation should be performed
  steps:
    - call: test -b {{filesystem:device}}
      shortdesc: Verify filesystem device
      error: Invalid filesystem device
      nodes: all
      when: filesystem
    - install:
        - apache2
      when: install
    - call: a2enable mod_status
      description: Enable status module
      nodes: all
      when: install
    - cib: |
        {{filesystem}}
        {{database}}
        {{apache}}
        {{virtual-ip}}
        group {{id}}
          {{filesystem:id}}
          {{database:id}}
          {{virtual-ip:id}}
          {{apache:id}}
