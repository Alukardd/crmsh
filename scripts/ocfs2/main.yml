# Copyright (C) 2009 Dejan Muhamedagic
# Copyright (C) 2015 Kristoffer Gronlund
#
# License: GNU General Public License (GPL)
---
- version: 2.2
  shortdesc: ocfs2 filesystem (cloned)
  longdesc: >
    This template generates a cloned instance of the ocfs2 filesystem

    NB: You need only one dlm, regardless of how many
    filesystems. In other words, you can use this template only for
    one filesystem and to make another one, you'll have to edit the
    resulting configuration yourself.
  category: Filesystem
  parameters:
    - name: id
      shortdesc: Name the ocfs2 filesystem
      example: bigfs
      type: resource-id
      required: true
    - name: directory
      shortdesc: The mount point
      example: /mnt/bigfs
      type: directory
      required: true
    - name: device
      shortdesc: The device
      type: device
      required: true
    - name: options
      shortdesc: mount options
      type: string
    - name: dlm
      shortdesc: Disable if dlm is already configured
      value: true
      type: boolean
  actions:
    - cib: |
        primitive {{id}} ocf:heartbeat:Filesystem
            params
                directory="{{directory}}"
                fstype="ocfs2"
                device="{{device}}"
                {{#options}}options="{{options}}"{{/options}}
            op start timeout=60s
            op stop timeout=60s

        monitor {{id}} 20s:40s

        {{#dlm}}
        primitive dlm ocf:pacemaker:controld
            op start timeout=90s
            op stop timeout=100s
            op monitor interval=60s timeout=60s
        {{/dlm}}

        clone base-{{id}} dlm meta interleave="true"
        clone clusterfs-{{id}} clusterfs meta interleave="true"
        order base-then-clusterfs-{{id}} inf: base-{{id}} clusterfs-{{id}}
        colocation clusterfs-with-base-{{id}} inf: clusterfs-{{id}} base-{{id}}
